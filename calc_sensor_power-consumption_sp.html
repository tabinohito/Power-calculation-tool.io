<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>サンプル</title>
    <meta charset="utf-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>

    <style>
    div#paging
    {
      text-align: center;
      /* スクロールに対してページングボックスの位置を固定 */
      position: fixed;
      /* 位置を指定 */
      bottom: 0;
      right:45%;
    }

    div#pagingbox{
      background: #FFF;
    }

    th{
      /* ヘッダ背景塗りつぶし */
      background: #eee;
      /* 枠線を1本線指定 */
      border: solid 1px;
      width:auto;
    }
    td {
     /* 枠線を1本線指定 */
      border: solid 1px;
      height: 100%;
      /* width: 100%; */
      width:auto;
      text-align: center;
      vertical-align: top;
    }
   table{
     /* 枠線を1本線指定 */
      border: solid 1px;
      border-collapse:  collapse;
      white-space: nowrap;
      table-layout: fixed;
    }
    </style>

  </head>

  <body>
    <h2 style="font-size:200%">センサモジュールの消費電力を計算</h2>
    <h4 style="font-size:150%">電源電圧</h4>
    <input type = "number" id = "voltage" style="width:8%;padding:5px;font-size:30px;"> [V] 
    <h4 style="font-size:150%">動作時消費電流</h4>
    <input type = "number" id = "motion_current" style="width:8%;padding:5px;font-size:30px;"> [mA]
    <h4 style="font-size:150%">静止時消費電流</h4>
    <input type = "number" id = "sleep_current" style="width:8%;padding:5px;font-size:30px;"> [mA]
    <h4 style="font-size:150%">動作回数/分</h4>
    <input type = "number" id = "count" style="width:8%;padding:5px;font-size:30px;"> [回]
    <h4 style="font-size:150%">動作時間/回</h4>
    <input type = "number" id = "time" style="width:8%;padding:5px;font-size:30px;"> [msec] 
    <p>
        <input type="button" id = "add_sensor"  style="width:8%;padding:5px;font-size:30px;" value="計算" onclick="add_();" />
        <input type="button" id="clear"  style="width:8%;padding:5px;font-size:30px;" value="消去" onclick="remove_();">
    </p>
    <!--テーブル生成位置-->
    <div id ='maintable'>
    </div>

    <script>
      var json =[     //jsonサンプルデータ

      ]

      var json_view =[]

      // table要素を生成
      var table = document.createElement('table');

      // ヘッダーを作成
      var tr = document.createElement('tr');
      var th_SELECT = document.createElement('th');
      th_SELECT.setAttribute("colspan", "3")
      // th要素内にテキストを追加
      th_SELECT.textContent = "SELECT";
      // th要素をtr要素の子要素に追加
      tr.appendChild(th_SELECT);
      table.appendChild(tr);

      tr = document.createElement('tr');
      var th_pwr = document.createElement('th');
      th_pwr.textContent = "電源電圧";
      tr.appendChild(th_pwr);
      var th_do_current = document.createElement('th');
      th_do_current.textContent = "動作時消費電流";
      tr.appendChild(th_do_current);
      var th_stop_current = document.createElement('th');
      th_stop_current.textContent = "静止時消費電流";
      tr.appendChild(th_stop_current);
      table.appendChild(tr);

      tr = document.createElement('tr');
      var th_1 = document.createElement('th');
      th_1.textContent = "動作回数/分";
      tr.appendChild(th_1);
      var th_2 = document.createElement('th');
      th_2.textContent = "動作時間/回";
      tr.appendChild(th_2);
      var th_3 = document.createElement('th');
      th_3.textContent = "平均消費電力";
      tr.appendChild(th_3);
      table.appendChild(tr);
      // 生成したtable要素を追加する
      document.getElementById('maintable').appendChild(table);
    </script>

    <script>

      function add_(){
        if(is_fill_textbox("voltage") && is_fill_textbox("motion_current") && is_fill_textbox("sleep_current") && is_fill_textbox("count")  && is_fill_textbox("time")){
          var obj = {"view":true,
                   "電源電圧":document.getElementById("voltage").value ,
                   "動作時消費電流":document.getElementById("motion_current").value * 1000 , 
                   "静止時消費電流":document.getElementById("sleep_current").value ,
                   "動作回数/分":document.getElementById("count").value , 
                   "動作時間/回":document.getElementById("time").value
                  };
          var buf = new data(obj);
          obj["平均消費電力"] = buf.ElectoricPower();
          json.push(obj);
          add_table(json);
          clear("voltage");clear("motion_current");clear("sleep_current");clear("count");clear("time");
        }
        else{
            alert("未入力項目があります");
        }
      };

      function remove_(){
        const remove_flag = document.getElementsByName("remove_flag");
        let table_counter = 0;
        for(let i = 0;i < json.length;i++){
          if(json[i].view){
            if(remove_flag[table_counter].checked){
              console.log(table_counter);
              json[i].view = false;
            }
            table_counter++;
          }
        }



        for(let i = 0,j = 0;i < json.length;i++){
          //１つの情報に付き3行で表示しているのでひとまとまりでさようなら～
          if(!json[i].view){
            console.log(remove_flag.length);
            if(remove_flag[j] != null){
              if(remove_flag[j].checked){
                console.log(j);
                for(let k = 1;k <= 3;k++){
                  table.deleteRow((j+1) * 3);
                }
              }
            }
          }else{
            j++;
          }
        }
        console.log(JSON.stringify(json, null, 2));
      };

      function add_table(obj){
          var TR_CHECK = document.createElement('tr');
          
          //チェックボックスを追加
          TR_CHECK.appendChild(add_checkbox());
          table.appendChild(TR_CHECK);

          //テーブル本体を追加
          var TR_FIRST_COL = document.createElement('tr');
          TR_FIRST_COL.appendChild(add_value_td(this.obj,"電源電圧"));
          TR_FIRST_COL.appendChild(add_value_td(this.obj,"動作時消費電流"));
          TR_FIRST_COL.appendChild(add_value_td(this.obj,"静止時消費電流"));
          table.appendChild(TR_FIRST_COL);

          var TR_SECOND_COL = document.createElement('tr');
          TR_SECOND_COL.appendChild(add_value_td(this.obj,"動作回数/分"));
          TR_SECOND_COL.appendChild(add_value_td(this.obj,"動作時間/回"));
          TR_SECOND_COL.appendChild(add_value_td(this.obj,"平均消費電力"));
          table.appendChild(TR_SECOND_COL);

          document.getElementById('maintable').appendChild(table);
          // console.log(JSON.stringify(this.obj, null, 2));
      }

      function add_checkbox(){        
        var check = document.createElement('input');
        check.setAttribute('type','checkbox');
        check.setAttribute('name','remove_flag');
        check.setAttribute("colspan", "3");
        return check;
      }

      function add_value_th(text){
        var th_value = document.createElement('th');
        th_value.textContent = this.text;
        return th_value;
      }

      function add_value_td(json,name){
        var td_value = document.createElement('td');
        td_value.textContent = this.json[this.json.length - 1][name];
        return td_value;
      }

      function isEmpty(obj){
        return !Object.keys(obj).length;
      }

      function is_fill_textbox(id){
        if(document.getElementById(id).value == '') {
            return false; 
        }
        return true;
      };
      
      function clear(id){
        document.getElementById(id).value = '';
      };
    </script>
    <script>
      class data{
        constructor(obj){
            this.voltage = obj["電源電圧"];           
            this.motion_current = obj["動作時消費電流"] / 1000; //mA -> A
            this.sleep_current = obj["静止時消費電流"] / 1000; //mA -> A
            this.count = obj["動作回数/分"];//1秒あたりの動作回数
            this.time = obj["動作時間/回"] / 1000; //msec -> sec
            this.motion_time = (this.time * this.count);//動作時間
            this.sleep_time =  60 - (this.time * this.count);//静止時間
        };

        ElectoricPower_motion(){ return this.voltage * this.motion_current; };
        ElectoricPower_all_motion(){ return this.ElectoricPower_motion() * this.motion_time; };
        ElectoricPowerHour_motion(){ return this.ElectoricPower_all_motion() / 60; };

        ElectoricPower_sleep(){ return this.voltage * this.sleep_current; };
        ElectoricPower_all_sleep(){ return this.ElectoricPower_sleep() * this.sleep_time; };
        ElectoricPowerHour_sleep(){ return this.ElectoricPower_all_sleep() / 60; };

        ElectoricPower(){  return ((this.ElectoricPower_all_motion() + this.ElectoricPower_all_sleep()) / 60); };
      };
    </script>
  </body>
</html>